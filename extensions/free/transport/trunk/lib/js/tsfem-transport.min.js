'use strict';window.tsfem_e_import=function(){const a=tsfem_e_transportL10n,b=a=>{a||=!1,["importer-submit"].forEach(b=>{const c=document.getElementById(`tsfem-e-transport-${b}`);c.classList.toggle("tsfem-button-disabled",a),c.disabled=a})},c=()=>b(!0),d=(a,b,c)=>{const d="#tsfem-e-transport-log-ajax";switch(a||"start"){case"start":tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);break;case"end":tsfem.updatedResponse(d,b,c);}},e=e=>{const h=e.target;if(h.disabled)return;let i=["tsfem-button-loading"];h.classList.add(...i),c(),d(),j();const l="tsfem-e-transport-importer",m=document.getElementById(l),n=new FormData(m);[...n.keys()].forEach(a=>{m.querySelectorAll(`[name="[${a}]"]`).forEach(a=>{a.dataset.handlerDisabled=!a.disabled,a.disable=!0})});const o="undefined"==typeof EventSource?g:f;o("import",n,a.i18n.logMessages.requestImport.replace("%s",m.querySelector(`[value="${n.get(`${l}[choosePlugin]`)}"]`)?.dataset.title)).then(a=>{d("end",1,a)}).catch(a=>{d("end",0,a)}).finally(()=>{b(),h.classList.remove(...i),[...n.keys()].forEach(a=>{m.querySelectorAll(`[name="${a}"]`).forEach(a=>{a.dataset.handlerDisabled&&(a.disabled=!1),delete a.dataset.handlerDisabled})}),k()})},f=(b,c,d)=>new Promise((e,f)=>{const g=new URL(ajaxurl,new URL(document.baseURI).origin);g.searchParams.append("action","tsfem_e_transport"),g.searchParams.append("handle",b),g.searchParams.append("nonce",a.nonce),g.searchParams.append("data",c&&new URLSearchParams([...c.entries()]).toString());const h=new EventSource(g.href);h.onopen=()=>{i(d)},h.onerror=()=>{h.close(),i(a.i18n.logMessages.unknownErrorFull,2),f(a.i18n.logMessages.unknownError)};const j=a=>{try{return JSON.parse(a)}catch(a){}},k=a=>{h.close();let b=j(a.data);i(b?.logMsg,2),f(b?.results.notice)};h.addEventListener("tsfem-e-transport-log",a=>{i(j(a.data)?.content)}),h.addEventListener("tsfem-e-transport-done",a=>{h.close();let b=j(a.data);i(b.logMsg,2),e(b?.results.notice)}),h.addEventListener("tsfem-e-transport-failure",k),h.addEventListener("tsfem-e-transport-locked",k),h.addEventListener("tsfem-e-transport-crash",k),h.addEventListener("tsfem-e-transport-timeout",a=>{i(j(a.data)?.logMsg)})}),g=(b,c,d)=>new Promise((e,f)=>{i(d,1),wp.ajax.post("tsfem_e_transport",{handle:b,nonce:a.nonce,data:c&&new URLSearchParams([...c.entries()]).toString()}).done(a=>{e(a?.results?.notice),i(a?.logMsg,2)}).fail(a=>{f(a.data?.results?.notice),i(a.data?.logMsg,2)})}),h=document.getElementById("tsfem-e-transport-logger"),i=(a,b)=>{h&&a?.length&&tsfem_ui.logger.queue(h,`\n&ratio; ${tsf.escapeString(tsf.decodeEntities(a))}${"\n".repeat(b||0)}`)},j=()=>h&&tsfem_ui.logger.start(h),k=()=>h&&tsfem_ui.logger.stop(h),l=b=>{if(b.preventDefault(),b.stopPropagation(),b.target.dataset?.lastValue===b.target.value)return;b.target.dataset.lastValue=b.target.value;const c="tsfem-e-transport-importer",d=JSON.parse(b.target.selectedOptions[0]?.dataset.importers),f=document.getElementById(`${c}-options`),g=document.getElementById(`${c}-supports-transformation-help`),h=document.getElementById(`${c}-submit`);f.innerHTML="",f.style.display="none",g.style.display="none";let i=!1,j=!1;const k=()=>{const a=document.querySelectorAll(`[name^="${c}\\[selectType\\]"]:checked`);i=!1,a.forEach(a=>{i=!!d[a.value]?.transform?.length}),g.style.display=i?null:"none";const b=!a.length;h.disabled=b,h.classList.toggle("tsfem-button-disabled",b)},l=b=>{const d=document.getElementById(`${c}-options-template`).content.cloneNode(!0);d.querySelector(`.${c}-selectType-description`).innerText=a.i18n.optionNames[b]??"";const e=d.querySelector(`[name^="${c}\\[selectType\\]"]`);e.value=b,f.appendChild(d),e.addEventListener("change",k),e.dispatchEvent(new Event("change"))};d.postmeta&&(l("postmeta"),j=!0),d.termmeta&&(l("termmeta"),j=!0),j&&(f.style.display=null),h.addEventListener("click",e)},m=()=>{const a=document.getElementById("tsfem-e-transport-importer[choosePlugin]");a.addEventListener("change",l),a.dispatchEvent(new Event("change"))};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",m)}})}(),window.tsfem_e_import.load();
