'use strict';window.tsfem_inpost=function(a){const b=tsfem_inpostL10n.post_ID,c=tsfem_inpostL10n.nonce,d=tsfem_inpostL10n.isPremium,e=tsfem_inpostL10n.locale,f=tsfem_inpostL10n.debug,g=tsfem_inpostL10n.i18n;let h=!1,i=!1;const j=d=>{const e=(a,b)=>{const c=document.querySelector(b),d=c.querySelectorAll(".tsf-notice, .notice"),e=200,f={duration:e,iterations:1};c.style.willChange="contents",1<d.length&&(c.style.maxHeight=`${c.getBoundingClientRect().height}px`,c.style.overflow="hidden",Array.from(d).slice(0,d.length-1).forEach(a=>{a.style.transformOrigin="bottom",a.animate([{transform:"scaleY(1)",maxHeight:`${a.clientHeight}px`,opacity:1},{transform:"scaleY(0)",maxHeight:0,opacity:0}],f),setTimeout(()=>a.remove(),e)}));const g=document.createElement("template");g.innerHTML=a,c.append(g.content);const h=c.lastChild;h.style.transformOrigin="bottom",h.animate([{transform:"scaleY(0)",maxHeight:0,opacity:1},{transform:"scaleY(1)",maxHeight:`${h.clientHeight}px`,opacity:1}],f),clearTimeout(i),i=setTimeout(()=>{c.style.maxHeight=null,c.style.overflow=null},e),tsf.triggerNoticeReset()},g=(d,e)=>{let g=a.Deferred(),h=e?1:0,i="";return a.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_inpost_get_dismissible_notice",post_ID:b,nonce:c,"tsfem-notice-key":d,"tsfem-notice-has-msg":h},timeout:7e3,async:!0}).done(a=>{a=tsf.convertJSONResponse(a),f&&void 0;let b=a?.data,c=a?.type;if(!b||!c||"undefined"==typeof b.notice);else{let a=b.notice;if(h){const b=document.createElement("div");b.innerHTML=a,window.isRtl?b.querySelector("p")?.insertAdjacentHTML("beforebegin",`${e} `):b.querySelector("p")?.insertAdjacentHTML("beforeend",` ${e}`),a=b.innerHTML}i=a}}).fail(()=>{tsf.l10n.states.debug&&(void 0);let a=h?wp.template("tsfem-inpost-notice-error"):wp.template("tsfem-inpost-notice-5xx"),b=a({code:d,msg:e});i=b}).always(()=>{g.resolve(i)}),g.promise()};return{in:a=>{if(d){if(h)return void setTimeout(()=>{j(d).in(a)},500);h=!0;let b=d.type||"error",c=d.code||void 0,f=d.text||"";if(void 0===c)g(-1,f).always(b=>{e(b,a),h=!1});else if(""===f)g(c,"").always(b=>{e(b,a),h=!1});else{const d=wp.template(`tsfem-inpost-notice-${b}`);e(d({code:c,msg:f}),a),h=!1}}}}},k=(a,b,c)=>{tsf.l10n.states.debug&&(void 0,void 0);let d="";switch(c){case"abort":case"timeout":d=g.TimeoutError;break;case"Bad Request":d=g.BadRequest;break;case"Internal Server Error":d=g.FatalError;break;case"parsererror":d=g.ParseError;break;default:d=g.UnknownError;}return d},l=(a,b)=>{if(a instanceof NodeList)return void a.forEach(a=>l(a,b));if(a&&!(!a instanceof Element)){["edit","loading","unknown","error","bad","warning","okay","good"].forEach(d=>{a.classList.remove(`tsfem-e-inpost-icon-${d}`),d===b&&a.classList.add(`tsfem-e-inpost-icon-${d}`)})}};var m={},n={};const o=(a,b,c,d)=>{var e=Number.parseFloat;if(!a||!a instanceof HTMLElement)return;a.style.willChange="opacity";let f=!1,g=!1;"function"==typeof c?(f=c,g=!0):"object"==typeof c&&(f=c?.cb||!1,g=c?.promise||!1),b||=250,d=!(void 0!==d)||d;let h,i,j,k=a.dataset.tsfemFadeId||"_"+Math.random().toString(22).substring(2,10)+Math.random().toString(22).substring(2,10),l=0;a.dataset.tsfemFadeId=k,"undefined"!=typeof m[k]&&(cancelAnimationFrame(m[k].frame),"show"===m[k].type?(a.style.opacity=1,a.style.display=null):(a.style.opacity=0,a.style.display="none"),delete m[k],"undefined"!=typeof n[k]&&n[k].resolve(),delete n[k]),g&&f&&(n[k]=new Promise,(()=>{n[k].then(()=>{delete n[k],f()})})(f)),m[k]={type:d?"show":"hide",frame:void 0},d?(a.style.display=null,a.style.opacity=0,h=c=>{i=void 0===i?c:i,j=(c-i)/b,l=+e(j).toPrecision(3),a.style.opacity=l,1<=l?(cancelAnimationFrame(m[k].frame),a.style.opacity=1,a.style.display=null,a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete m[k],g?n?.[k].resolve():f&&f()):m[k].frame=requestAnimationFrame(h)}):(a.style.display=null,a.style.opacity=1,h=c=>{i=void 0===i?c:i,j=(c-i)/b,l=+e(1-j).toPrecision(3),a.style.opacity=l,a.style.display=null,0>=l?(cancelAnimationFrame(m[k].frame),a.style.opacity=0,a.style.display="none",a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete m[k],g?n?.[k].resolve():f&&f()):m[k].frame=requestAnimationFrame(h)}),m[k].frame=requestAnimationFrame(h)};return Object.assign({load:()=>{}},{postID:b,nonce:c,isPremium:d,locale:e,debug:f,i18n:g},{isActionableElement:a=>!(!a instanceof HTMLElement)&&(a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLLabelElement||a instanceof HTMLButtonElement||a instanceof HTMLTextAreaElement),escapeStr:(a,b)=>a.length?b?a.replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]):a.replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[a]):"",promiseLoop:(a,b,c,d=2e3)=>new Promise((e,f)=>{let g=a.length;if(!g)return e();const h=i=>{let j,k,l;d&&(k=setTimeout(()=>{clearTimeout(j),l=setTimeout(()=>{f()},250)},d)),j=setTimeout(()=>new Promise(async(c,d)=>{try{await b(a[i]),c()}catch(a){d()}}).then(()=>{if(d&&(clearTimeout(k),l)){if(i<g)return;clearTimeout(l)}++i===g?e():(j=null,h(i))}).catch(()=>{f()}),c)};h(0)}),doAjax:(b,c)=>new Promise((e,h)=>{let i,l=c.noticeArea,m=c.premium||!1;return m&&!d?h():void(f&&void 0,a.ajax(b).done(a=>{a=tsf.convertJSONResponse(a),f&&void 0;let b=a?.data,c=a?.type;if(!b||!c)return i={type:"error",code:-1,text:g.InvalidResponse},void h();let d=b?.results?.code,j=b?.results?.notice,k=b?.results?.type;d&&k&&(i={type:k,code:d,text:j}),"success"===c&&"data"in b?e(b.data):h(d)}).fail((a,b,c)=>{tsf.l10n.states.debug&&(void 0,void 0),i={type:"error",code:-1,text:k(a,b,c)},h()}).always(()=>{i&&j(i).in(l)}))}),setFlexNotice:j,getAjaxError:k,setIconClass:l,fadeOut:(a,b,c)=>{o(a,b,c,!1)},fadeIn:o,debounce:(a,b=0)=>{let c=0;return()=>(clearTimeout(c),{timeoutId:c=setTimeout(a,b),cancel:()=>clearTimeout(c)})}})}(jQuery),window.tsfem_inpost.load();
